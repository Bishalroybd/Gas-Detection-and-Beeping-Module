#include <LiquidCrystal.h>

// LCD pin configuration (RS, Enable, D4, D5, D6, D7)
LiquidCrystal lcd(12, 11, 5, 4, 3, 2);

// Pin definitions
const int RED_LED = 7;
const int GREEN_LED = 8;
const int BUZZER = 9;
const int GAS_SENSOR = A0;
const int BUTTON_RESET = 6;

// Gas concentration thresholds
const int SENSOR_THRESHOLD = 400;
const int HIGH_ALERT_THRESHOLD = 600;
const int CRITICAL_THRESHOLD = 800;

// Variables
int gasValue = 0;
bool systemActive = true;
unsigned long lastAlertTime = 0;
const unsigned long ALERT_INTERVAL = 5000; // 5 seconds

void setup() {
  // Initialize pins
  pinMode(RED_LED, OUTPUT);
  pinMode(GREEN_LED, OUTPUT);
  pinMode(BUZZER, OUTPUT);
  pinMode(BUTTON_RESET, INPUT_PULLUP);
  pinMode(GAS_SENSOR, INPUT);
  
  // Initialize LCD
  lcd.begin(16, 2);
  
  // Initialize serial communication
  Serial.begin(9600);
  
  // System startup sequence
  startupSequence();
  
  // Display initial message
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("Gas Detector");
  lcd.setCursor(0, 1);
  lcd.print("System Ready");
  delay(2000);
}

void loop() {
  // Read reset button
  if (digitalRead(BUTTON_RESET) == LOW) {
    resetSystem();
    delay(500); // Debounce delay
  }
  
  // Read gas sensor value
  gasValue = analogRead(GAS_SENSOR);
  
  // Print sensor value to serial monitor
  Serial.print("Gas Level: ");
  Serial.println(gasValue);
  
  // Check gas levels and trigger alerts
  if (gasValue >= CRITICAL_THRESHOLD) {
    criticalAlert();
  } else if (gasValue >= HIGH_ALERT_THRESHOLD) {
    highAlert();
  } else if (gasValue >= SENSOR_THRESHOLD) {
    mediumAlert();
  } else {
    safeCondition();
  }
  
  delay(1000); // Update every second
}

void startupSequence() {
  // LED test sequence
  digitalWrite(RED_LED, HIGH);
  digitalWrite(GREEN_LED, HIGH);
  tone(BUZZER, 1000, 500);
  delay(500);
  digitalWrite(RED_LED, LOW);
  digitalWrite(GREEN_LED, LOW);
  delay(500);
  
  lcd.clear();
  lcd.print("System Booting...");
  delay(1000);
}

void resetSystem() {
  noTone(BUZZER);
  digitalWrite(RED_LED, LOW);
  digitalWrite(GREEN_LED, HIGH);
  
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("System Reset");
  lcd.setCursor(0, 1);
  lcd.print("Monitoring...");
  
  Serial.println("System Reset - Resuming Monitoring");
}

void safeCondition() {
  noTone(BUZZER);
  digitalWrite(GREEN_LED, HIGH);
  digitalWrite(RED_LED, LOW);
  
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("Status: SAFE");
  lcd.setCursor(0, 1);
  lcd.print("Gas Level: ");
  lcd.print(gasValue);
}

void mediumAlert() {
  digitalWrite(GREEN_LED, LOW);
  digitalWrite(RED_LED, HIGH);
  
  // Intermittent buzzer
  if (millis() - lastAlertTime > ALERT_INTERVAL) {
    tone(BUZZER, 800, 1000);
    lastAlertTime = millis();
  }
  
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("ALERT: Gas Detected");
  lcd.setCursor(0, 1);
  lcd.print("Level: ");
  lcd.print(gasValue);
  
  Serial.println("MEDIUM ALERT: Gas detected!");
}

void highAlert() {
  digitalWrite(GREEN_LED, LOW);
  digitalWrite(RED_LED, HIGH);
  
  // Faster buzzer pattern
  tone(BUZZER, 1200, 500);
  
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("HIGH ALERT!");
  lcd.setCursor(0, 1);
  lcd.print("Level: ");
  lcd.print(gasValue);
  
  Serial.println("HIGH ALERT: Dangerous gas levels!");
}

void criticalAlert() {
  digitalWrite(GREEN_LED, LOW);
  digitalWrite(RED_LED, HIGH);
  
  // Continuous buzzer
  tone(BUZZER, 1500);
  
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("CRITICAL ALERT!");
  lcd.setCursor(0, 1);
  lcd.print("EVACUATE NOW!");
  
  Serial.println("CRITICAL ALERT: EVACUATE IMMEDIATELY!");
}
